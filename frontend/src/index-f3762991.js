import{B as e,t as s,a as r}from "./index-7ba3e52d.js";customElements.define("web-subscribe",class extends e{constructor(){super(),this.checkboxes=["WebDevNewsletter","collects-pii-spii-checkbox"],this.needsDoubleOptIn=["AT: Austria","DE: Germany","GR: Greece","LU: Luxembourg","NO: Norway"],this.processing=!1,this.submitted=!1,this.onError=this.onError.bind(this),this.onSubmit=this.onSubmit.bind(this),this.onSuccess=this.onSuccess.bind(this),window.recaptchaSuccess=this.captchaCheck.bind(this)}connectedCallback(){super.connectedCallback(),this.form=this.querySelector("form"),this.subscribeError=this.querySelector(".subscribe__error"),this.subscribeMessage=this.querySelector(".subscribe__message"),this.submissionUrl=this.form.action,this.submissionUrl||console.warn("No submission URL found for subscribe element."),this.form.submit=()=>this.onError(new Error("Please fill out the form")),this.form.addEventListener("submit",this.onSubmit)}detachedCallback(){this.form.removeEventListener("submit",this.onSubmit),window.recaptchaSuccess=null}captchaCheck(){return 0!==window.grecaptcha.getResponse().length||(this.onError(new Error("Please complete the reCAPTCHA.")),!1)}cleanForm(e){const s=this.needsDoubleOptIn.includes(String(e.get("Country")));return this.checkboxes.forEach((r=>e.set(r,s?"Unconfirmed":"True"))),e.delete("g-recaptcha-response"),e}postForm(e){return fetch(this.submissionUrl,{method:"POST",body:e}).then((e=>e.json()))}onError(e, r=!1){if(!this.subscribeError)return void console.warn("Could not find area to display error in subscribe element.");const t=new Error("Could not submit, please try again.");this.subscribeError.querySelector(".subscribe__error__message").textContent=r?t.message:(e||t).message,this.subscribeError.classList.toggle("hidden-yes",!1),s(e,"Email form failed to submit because")}onSubmit(e){if(e.preventDefault(),this.processing||this.submitted||!this.captchaCheck())return;this.processing=!0;const s=new FormData(e.target),r=this.cleanForm(s);this.postForm(r).then((e=>{if(e&&"accepted"===e.result)this.onSuccess();else if(e&&e.errors){const s=Object.values(e.errors).join(" ");this.onError(new Error(s))}else this.onError(new Error(e.result),!0)})).catch((e=>this.onError(e,!0))).finally((()=>this.processing=!1))}onSuccess(){this.submitted=!0,this.subscribeError.classList.toggle("hidden-yes",!0),this.subscribeError.querySelector(".subscribe__error__message").textContent="",this.subscribeMessage.textContent="Thank you! You're all signed up.",this.form.removeEventListener("submit",this.onSubmit),this.form.parentElement.removeChild(this.form),r({category:"web.dev",action:"submit",label:"subscribe, newsletter"})}});
